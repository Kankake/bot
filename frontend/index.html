<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–æ–±–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ | LEVITA</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <style>
    :root {
      --bg-light: #FDF5F9;
      --card-bg: #FFFFFF;
      --text-dark: #272727;
      --text-muted: #555555;
      --accent-gold: #D4AF37;
      --btn-hover: #b5942c;
      --card-radius: 12px;
      --gap: 12px;
    }
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
    html, body { height: 100%; -webkit-text-size-adjust: 100%;}
    body {
      background: var(--bg-light);
      font-family: 'Roboto', sans-serif;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .contact-us p {
      margin: 0;
      font-size: 1rem;
      color: var(--text-dark);
    }
    /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è –±–ª–æ–∫–∞ —Å–Ω–∏–∑—É */
     .contact-us {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 400px;
      background: var(--card-bg);
      z-index: 100;
      padding: 2px 8px;     /* —É–∂–µ –ø–æ –≤—ã—Å–æ—Ç–µ —Ç–µ–∫—Å—Ç–∞ */
      display: flex;
      align-items: center;
      justify-content: space-between;
     }
    .contact-us a {
          background: var(--text-muted) !important;
          color: #fff !important;
          padding: 4px 8px;
          border-radius: 6px;
          text-decoration: none;
          font-weight: 500;
          font-size: 0.9rem;
        }
    .logo {
      display: block;
      max-width: 400px;
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      top: 0;
      z-index: 1;
    }

    .container {
   width: 100%;
  max-width: 400px;
  padding: 0 16px;
  margin: 0 auto;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 2;
  -webkit-transform: translate(-50%, -50%);
}

    .card { background: var(--card-bg); border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 20px; text-align: center; width: 100%;
  min-height: fit-content;
  padding: 20px;
  margin-bottom: 16px;
  -webkit-appearance: none;}
    h1 { font-size: 1.5rem; margin-bottom: 16px; color: var(--accent-gold); }
    p { font-size: 0.95rem; margin-bottom: 16px; line-height: 1.4; }
    .step { display: none; }
    .step.active { display: block; }
    
    .option.selected { background: var(--accent-gold); color: #fff; }

    .option {
      position: relative;
      display: block;
      padding: 12px;
      border: 2px solid var(--accent-gold);
      border-radius: 8px;
      cursor: pointer;
      background: var(--card-bg);
      color: var(--text-dark);
      font-weight: 500;
      margin-bottom: 12px;
      min-height: 44px;
      padding: 12px 16px;
      margin-bottom: 12px;
      -webkit-tap-highlight-color: transparent;
    }

@supports (padding: max(0px)) {
  .contact-us {
    padding-bottom: max(12px, env(safe-area-inset-bottom));
    padding-left: max(12px, env(safe-area-inset-left));
    padding-right: max(12px, env(safe-area-inset-right));
  }
}
    .info-btn {
      position: absolute;
      top: 50%;
      right: 8px;
      transform: translateY(-50%);
      border: none;
      padding: 2px;
      cursor: pointer;
      width: 24px;
      height: 24px;
      min-width: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
    }



.info-btn svg {
  width: 16px;
  height: 16px;
  color: var(--text-dark);
}

.info-btn:hover svg {
  color: var(--text-muted);
}

    .option span {
      flex: 1;
      padding-right: 8px;
    }

    .description {
      font-size: 0.85rem;
      color: var(--text-muted);
      text-align: left;
      line-height: 1.4;
      background: #f9f9f9;
      padding: 0;
      border-radius: 6px;
      width: 100%;
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s ease-in-out;
      opacity: 0;
      margin: 0;
    }

    .description.active {
      padding: 10px;
      max-height: 500px;
      opacity: 1;
      margin: 8px 0 4px;
    }

    .description.active + .collapse-btn {
      display: inline-block;
    }

    .description.active ~ .info-btn {
      display: none;
    }

    .collapse-btn {
      background: var(--text-muted);
      border: none;
      border-radius: 4px;
      padding: 1px 6px;       /* –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –∏ —á—É—Ç—å –ø–æ–±–æ–ª—å—à–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø */
      font-size: 0.7rem;      /* —á—É—Ç—å –º–µ–Ω—å—à–µ —à—Ä–∏—Ñ—Ç */
      color: var(--card-bg);
      cursor: pointer;
      display: inline-block;
      white-space: nowrap;
      line-height: 1;         /* —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–π ¬´–≤–æ–∑–¥—É—Ö¬ª –ø–æ –≤—ã—Å–æ—Ç–µ */
      margin: 4px 0 0 auto;
    }


    .collapse-btn:hover { background: var(--btn-hover); }

    input, button { font-family: 'Roboto', sans-serif; }
    input[type="text"], input[type="tel"] { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 6px; font-size: 1rem; }
    .buttons { display: flex; gap: 12px; justify-content: center; }
    button { flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; font-weight: 500; -webkit-appearance: none;
  min-height: 44px;
  touch-action: manipulation;}
    .collapse-btn {
      min-height: 0 !important;
      padding: 4px 8px !important;
      font-size: 0.75rem !important;
      line-height: 1.5 !important;
    }
    .primary { background: var(--accent-gold); color: #fff; }
    .primary:hover { background: var(--btn-hover); }
    .secondary { background: var(--text-muted); color: #fff; }
    .secondary:hover { background: var(--text-muted); }
    ul { list-style: none; padding: 0; margin: 0 0 16px; text-align: left; }
    ul li { margin-bottom: 8px; }
    ul b { color: var(--accent-gold); }
    .zv {color: #000; font-family: 'Calibri'; align-self: center; margin: 8px 8px 8px 8px;}
    #options-goal {
  max-height: 60vh; /* 60% of viewport height */
  overflow-y: auto; /* Enable vertical scrolling */
  padding-right: 8px; /* Add some padding for the scrollbar */
}

/* Optional: Style the scrollbar for webkit browsers */
#options-goal::-webkit-scrollbar {
  width: 8px;
}

#options-goal::-webkit-scrollbar-track {
  background: var(--bg-light);
  border-radius: 4px;
}

#options-goal::-webkit-scrollbar-thumb {
  background: var(--text-muted);
  border-radius: 4px;
}

#options-goal::-webkit-scrollbar-thumb:hover {
  background: var(--accent-gold);
}
  </style>
</head>
<body>
  <img src="assets/levita.png" class="logo">
  <div class="container">
    <div id="step-1" class="card step active">
      <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
      <p>–ú—ã —Å–µ—Ç—å —Å—Ç—É–¥–∏–π <strong>LEVITA –≥. –ù–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫</strong>. –ò –º—ã —Ä–∞–¥—ã, —á—Ç–æ –≤—ã –≤—ã–±—Ä–∞–ª–∏ –Ω–∞—Å! –ù–∞–∂–º–∏—Ç–µ –¥–∞–ª–µ–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏ –ø–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä–≤–æ–µ –∑–∞–Ω—è—Ç–∏–µ <strong>–±–µ—Å–ø–ª–∞—Ç–Ω–æ</strong>.</p>
      <div class="buttons"><button class="primary" id="startBtn">–î–∞–ª–µ–µ</button></div>
    </div>
    <div id="step-2" class="card step">
      <h1>–í–∞—à–∞ —Ü–µ–ª—å</h1>
      <p>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É —Ü–µ–ª—å ‚Äì –∏ –º—ã –ø–æ–¥—Å–∫–∞–∂–µ–º, –∫—É–¥–∞ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è</p>
      <div class="options" id="options-goal">
        <div class="option" data-val="–£–ª—É—á—à–∏—Ç—å –≥–∏–±–∫–æ—Å—Ç—å">üßò –£–ª—É—á—à–∏—Ç—å –≥–∏–±–∫–æ—Å—Ç—å –∏ —Å–µ—Å—Ç—å –Ω–∞ —à–ø–∞–≥–∞—Ç</div>
        <div class="option" data-val="–£–∫—Ä–µ–ø–∏—Ç—å —Ç–µ–ª–æ">üí™ –£–∫—Ä–µ–ø–∏—Ç—å —Ç–µ–ª–æ –∏ –º—ã—à—Ü—ã-—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä—ã</div>
        <div class="option" data-val="–£–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–π –≤–µ—Å">üî• –£–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–π –≤–µ—Å –∏ –ø–æ–¥—Ç—è–Ω—É—Ç—å —Ñ–∏–≥—É—Ä—É</div>
        <div class="option" data-val="–°–Ω—è—Ç—å —Å—Ç—Ä–µ—Å—Å">ü™∑ –°–Ω—è—Ç—å —Å—Ç—Ä–µ—Å—Å –∏ —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã</div>
        <div class="option" data-val="–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Å–∞–Ω–∫—É">ü©∞ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Å–∞–Ω–∫—É –∏ –ø–æ—Ö–æ–¥–∫—É</div>
        <div class="option" data-val="–ü–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å">üë† –ü–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∏ –ª—ë–≥–∫–æ—Å—Ç—å</div>
        <div class="option" data-val="–ù–∞—É—á–∏—Ç—å—Å—è —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å">üéº –ù–∞—É—á–∏—Ç—å—Å—è —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—á—Ç—É –¥–µ—Ç—Å—Ç–≤–∞</div>
        <div class="option" data-val="–ù–∞—á–∞—Ç—å –∑–∞–Ω–∏–º–∞—Ç—å—Å—è">üéØ –ù–∞—á–∞—Ç—å –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Å–æ–±–æ–π —Ä–µ–≥—É–ª—è—Ä–Ω–æ</div>
        <div class="option" data-val="–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—é">üíÉ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—é –∏–ª–∏ —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏–∏</div>
        <div class="option" data-val="–£–ª—É—á—à–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é">ü§∏ –£–ª—É—á—à–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é –∏ –≤–ª–∞–¥–µ–Ω–∏–µ —Ç–µ–ª–æ–º</div>
        <div class="option" id="chooseSelf" data-val="–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä">üíõ –•–æ—á—É –≤—ã–±—Ä–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∞–º–∞</div>
      </div>
      <div class="buttons">
        <button class="secondary" id="back2">–ù–∞–∑–∞–¥</button>
        <button class="primary" id="next2">–î–∞–ª–µ–µ</button>
      </div>
    </div>
    <div id="step-3" class="card step">
      <h1>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏—è</h1>
      <div class="options" id="options-dir"></div>
      <div class="buttons">
        <button class="secondary" id="back3">–ù–∞–∑–∞–¥</button>
        <button class="primary" id="next3">–î–∞–ª–µ–µ</button>
      </div>
    </div>
    <div id="step-4" class="card step">
      <h1>–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—É—é —Å—Ç—É–¥–∏—é</h1>
      <div class="options" id="options-address">
        <div class="option" data-val="–°–≤–æ–±–æ–¥—ã 6">–°–≤–æ–±–æ–¥—ã 6 (–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π)</div>
        <div class="option" data-val="–í–∏–¥–æ–≤–∞ 210–î">–í–∏–¥–æ–≤–∞ 210–î (–ü—Ä–∏–º–æ—Ä—Å–∫–∏–π)</div>
        <div class="option" data-val="–î–∑–µ—Ä–∂–∏–Ω—Å–∫–æ–≥–æ 211/2">–î–∑–µ—Ä–∂–∏–Ω—Å–∫–æ–≥–æ 211/2 (–Æ–∂–Ω—ã–π)</div>
      </div>
      <div class="buttons">
        <button class="secondary" id="back4">–ù–∞–∑–∞–¥</button>
        <button class="primary" id="next4">–î–∞–ª–µ–µ</button>
      </div>
    </div>
    <div id="step-5" class="card step">
      <h1>–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã –¥–ª—è –∑–∞–ø–∏—Å–∏</h1>
      <div class="options" id="options-slots"></div>
      <div class="buttons">
        <button class="secondary" id="back5">–ù–∞–∑–∞–¥</button>
        <button class="primary" id="next5">–î–∞–ª–µ–µ</button>
      </div>
      <div class="buttons" style="margin-top: 8px;">
        <button class="more" id="weekBtn">–ë–æ–ª—å—à–µ</button>
      </div>
    </div>
        <div id="step-6" class="card step">
      <h1>–í–∞–∂–Ω–æ:</h1>
      <div style="margin-bottom: 16px;">
      <span class="zv" >–•–æ—Ç–∏–º –í–∞—Å —É–≤–µ–¥–æ–º–∏—Ç—å, —á—Ç–æ –ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ –Ω–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ –í—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å–µ—Ç–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –ø—Ä–æ–±–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑.
 –ï—Å–ª–∏ –í—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ –í–∞—à—É –∑–∞–ø–∏—Å—å, –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ –ø–æ—Å–µ—Ç–∏—Ç—å –±–æ–ª—å—à–µ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è.
              –í–µ–¥—å –Ω–∞—à–∞ –∫–æ–º–ø–∞–Ω–∏—è –Ω–µ –ø—Ä–æ –º–∞—Å—Å–æ–≤–æ—Å—Ç—å, –∫–∞–∂–¥—ã–π –ø–µ–¥–∞–≥–æ–≥ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤.
                –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é –∑–∞–ø–∏—Å—å?
                –ò–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å—Å—è?
              </span>
              </div>
      <div class="buttons">
        <button class="secondary" id="back6" >–ò–∑–º–µ–Ω–∏—Ç—å</button>
        <button class="primary" id="submit6" >–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      </div>
    </div>
    <div id="step-7" class="card step">
      <div style="margin-bottom: 16px;">
        <b style="align-content: center; color: #505050; font-size: 1.3ic;">–ù–µ –∑–∞–±—É–¥—å—Ç–µ —Å —Å–æ–±–æ–π –≤–∑—è—Ç—å —Ñ–æ—Ä–º—É –∏ —Ö–æ—Ä–æ—à–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ!</b>
      </div>
      <ul>
        <li><b>–¶–µ–ª—å:</b> <span id="sum-goal"></span></li>
        <li><b>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</b> <span id="sum-dir"></span></li>
        <li><b>–°—Ç—É–¥–∏—è:</b> <span id="sum-address"></span></li>
        <li><b>–°–ª–æ—Ç:</b> <span id="sum-slot"></span></li>
      </ul>
      <div class="buttons">
        <button class="secondary" id="back7">–ù–∞–∑–∞–¥</button>
        <button class="primary" id="submit7">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </div>
    <div id="step-8" class="card step">
      <h1>–ì–æ—Ç–æ–≤–æ!</h1>
      <p>–°–ø–∞—Å–∏–±–æ! –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–≤–æ—é –∑–∞–ø–∏—Å—å –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º–µ, –æ—Ç–ø—Ä–∞–≤–∏–≤ –≤–∞—à–µ –∏–º—è –∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.<br>–î–æ —Å–∫–æ—Ä—ã—Ö –≤—Å—Ç—Ä–µ—á!</p>
      <div class="buttons"><button class="primary" id="thankBtn">–ó–∞–∫—Ä—ã—Ç—å</button></div>
    </div>
  </div>
<div class="card contact-us">
      <p>–°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏:</p>
      <div class="buttons">
        <a href="https://t.me/levita_nvrsk" target="_blank" class="secondary">–¢–µ–ª–µ–≥—Ä–∞–º</a>
        <a href="https://wa.me/79284085968" target="_blank" class="secondary">WhatsApp</a>
      </div>
    </div>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    const steps = ['step-1','step-2','step-3','step-4','step-5','step-6','step-7','step-8'];
    let data = {};
    const show = id => {
      steps.forEach(s => document.getElementById(s).classList.remove('active'));
      document.getElementById(id).classList.add('active');
    };
    // Step1
    document.getElementById('startBtn').addEventListener('click', () => show('step-2'));
    // Step2
    document.querySelectorAll('#options-goal .option').forEach(el => {
      el.addEventListener('click', () => {
        document.querySelectorAll('#options-goal .option').forEach(o => o.classList.remove('selected'));
        el.classList.add('selected');
        data.goal = el.dataset.val;
      });
    });
    document.getElementById('back2').addEventListener('click', () => show('step-1'));
    document.getElementById('next2').addEventListener('click', () => {
      if (!data.goal) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å');
        return;
      }
      // –µ—Å–ª–∏ –≤—ã–±—Ä–∞–ª–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
      if (data.goal === '–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä') {
        populateDirs(true);
      } else {
        populateDirs(false);
      }
      show('step-3');
    });


    // Step3
    document.getElementById('back3').addEventListener('click', () => show('step-2'));
    document.getElementById('next3').addEventListener('click', () => data.direction && show('step-4'));
    // Step4
    document.querySelectorAll('#options-address .option').forEach(el => {
      el.addEventListener('click', () => {
        document.querySelectorAll('#options-address .option').forEach(o => o.classList.remove('selected'));
        el.classList.add('selected');
        data.address = el.dataset.val;
      });
    });
    document.getElementById('back4').addEventListener('click', () => show('step-3'));
    document.getElementById('next4').addEventListener('click', () => {
      if (!data.address) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–∏—é');
        return;
      }
      fetchAndShowSlots();
    });
    // Step5
    document.getElementById('back5').addEventListener('click', () => show('step-4'));
    document.getElementById('next5').addEventListener('click', () => {
    if (!data.slot) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è –∑–∞–ø–∏—Å–∏');
      return;
    }
  
      document.getElementById('sum-goal').textContent = data.goal;
      document.getElementById('sum-dir').textContent = data.direction;
      document.getElementById('sum-address').textContent = data.address;
      document.getElementById('sum-slot').textContent = data.slot;
      show('step-6');
    });
    // Step6
    document.getElementById('back6').addEventListener('click', () => show('step-5'));
    document.getElementById('submit6').addEventListener('click', () => {
      show('step-7');
    });

    // Step7
    document.getElementById('back7').addEventListener('click', () => show('step-6'));
    
    document.getElementById('submit7').addEventListener('click', async () => {
      const resp = await fetch('/submit', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ telegram_id: tg.initDataUnsafe.user.id, ...data }) });
      const res = await resp.json();
      if (res.ok) show('step-8'); else alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
    });
    document.getElementById('thankBtn').addEventListener('click', () => tg.close());

    const directionDescriptions = {
      '–¢–∞–Ω—Ü—ã –Ω–∞—Ä–æ–¥–æ–≤ –º–∏—Ä–∞': '–£–Ω–∏–∫–∞–ª—å–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è –≤–∞—Å –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –º–∏—Ä —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö –∫—É–ª—å—Ç—É—Ä –∏ —Ç—Ä–∞–¥–∏—Ü–∏–π, –¥–æ–±–∞–≤–∏—Ç—å –∫—Ä–∞—Å–æ–∫ –≤ —Å–≤–æ—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—É—é —Ä—É—Ç–∏–Ω—É. –ó–Ω–∞–∫–æ–º–∏–º—Å—è —Å —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –Ω–∞—Ä–æ–¥–∞—Ö –∏ —Ä–∞–∑—É—á–∏–≤–∞–µ–º —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—É—é —Å–≤—è–∑–∫—É.',
      '–ë–∞—Ä—Ä–µ': '–î–∏–Ω–∞–º–∏—á–Ω–∞—è —Å–∏–ª–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —É —Å—Ç–∞–Ω–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º—è—á–∏–∫–æ–≤ –∏ —Ä–µ–∑–∏–Ω–æ–≤—ã—Ö —ç—Å–ø–∞–Ω–¥–µ—Ä–æ–≤. –ü—Ä–æ—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –º—ã—à—Ü—ã –Ω–æ–≥, –ø—Ä–µ—Å—Å–∞ –∏ —è–≥–æ–¥–∏—Ü. –ó–∞–Ω—è—Ç–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ–¥ –±–æ–¥—Ä—É—é —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é –º—É–∑—ã–∫—É —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏–∏. –û—á–µ–Ω—å –Ω–µ–æ–±—ã—á–Ω–æ–µ –∏ –ª—é–±–∏–º–æ–µ –Ω–∞—à–∏–º–∏ –∫–ª–∏–µ–Ω—Ç–∫–∞–º–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ!',
      '–ë–æ–¥–∏-–ë–∞–ª–µ—Ç': '–°–∏–ª–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞, –∫–æ—Ç–æ—Ä–∞—è —Å–æ—á–µ—Ç–∞–µ—Ç –≤ —Å–µ–±–µ —Ñ–∏—Ç–Ω–µ—Å –∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—é. –£–ª—É—á—à–∞–µ—Ç—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –∏ –±–∞–ª–∞–Ω—Å, —É–∫—Ä–µ–ø–ª—è—é—Ç—Å—è –º—ã—à—Ü—ã –≤—Å–µ–≥–æ —Ç–µ–ª–∞, –æ—Å–æ–±–µ–Ω–Ω–æ –º—ã—à—Ü—ã –∫–æ—Ä–∞. –ë–ª–∞–≥–æ–¥–∞—Ä—è –∞–∫—Ç–∏–≤–Ω–æ–º—É —Ç–µ–º–ø—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Ä–∞—Å—Ç–µ—Ç –æ–±—â–∞—è –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å.',
      '–ë–∞–ª–µ—Ç–Ω–∞—è –ø–æ–¥–∫–∞—á–∫–∞': '–ö—Ä—É–≥–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–∞ –∫–æ–≤—Ä–∏–∫–∞—Ö, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –Ω–∞ –ø—Ä–æ–∫–∞—á–∫—É —è–≥–æ–¥–∏—Ü –∏ –ø—Ä–µ—Å—Å–∞. –ü–æ–¥—Ö–æ–¥–∏—Ç —Ç–µ–º, –∫—Ç–æ —Ö–æ—á–µ—Ç –ø–æ—Ö—É–¥–µ—Ç—å –∏ —É–∂–µ –∏–º–µ–ª —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É.',
      '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è (–Ω–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)': '–ó–∞–Ω—è—Ç–∏–µ —É –±–∞–ª–µ—Ç–Ω–æ–≥–æ —Å—Ç–∞–Ω–∫–∞ –ø–æ–¥ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é –º—É–∑—ã–∫—É. –ü—Ä–æ—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –º—ã—à—Ü—ã –Ω–æ–≥, —Ä—É–∫ –∏ –∫–æ—Ä–ø—É—Å–∞, —É–ª—É—á—à–∞–µ—Ç—Å—è –æ—Å–∞–Ω–∫–∞, –≤—ã–≤–æ—Ä–æ—Ç–Ω–æ—Å—Ç—å –∏ –ø–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å. –°–∂–∏–≥–∞–µ—Ç—Å—è 300‚Äì800 –∫–∞–ª–æ—Ä–∏–π –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É.',
      '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è (—Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å)': '–ù—É–∂–Ω—ã –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏–∏, –∑–∞–Ω—è—Ç–∏–µ —É –±–∞–ª–µ—Ç–Ω–æ–≥–æ —Å—Ç–∞–Ω–∫–∞ –∏ –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ –∑–∞–ª–∞ –ø–æ–¥ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é –º—É–∑—ã–∫—É. –û—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏. –°–∂–∏–≥–∞–µ—Ç—Å—è 300‚Äì800 –∫–∞–ª–æ—Ä–∏–π –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É.',
      '–†–∞—Å—Ç—è–∂–∫–∞': '–°—Ç–∞—Ç–∏—á–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ –≥–∏–±–∫–æ—Å—Ç–∏, –ø–æ–¥–≤–∏–∂–Ω–æ—Å—Ç–∏ —Å—É—Å—Ç–∞–≤–æ–≤ –∏ —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ –º—ã—à—Ü. –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –±–æ–ª—å –∏ —Å–Ω–∏–∂–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ç—Ä–∞–≤–º.',
      '–ü–∏–ª–∞—Ç–µ—Å': '–°—Ç–∞—Ç–∏—á–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞, —Ä–∞–∑–≤–∏–≤–∞—é—â–∞—è —Ñ–∏–∑–∏—á–µ—Å–∫—É—é —Å–∏–ª—É, –≥–∏–±–∫–æ—Å—Ç—å, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é. –°–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å, —É—Å–∏–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –º–µ–¥–ª–µ–Ω–Ω–æ–º —Ç–µ–º–ø–µ –ø–æ–¥ —Å–ø–æ–∫–æ–π–Ω—É—é –º—É–∑—ã–∫—É.',
      '–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø—É–∞–Ω—Ç—ã': '–ó–∞–Ω—è—Ç–∏–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –¥–µ–≤—É—à–∫–∏ –≤—Å—Ç–∞—é—Ç –Ω–∞ –ø—É–∞–Ω—Ç—ã. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º—ã—à—Ü —Å—Ç—É–ø–Ω–∏ –∏ –≥–æ–ª–µ–Ω–∏ –Ω–∞ –∫–æ–≤—Ä–∏–∫–∞—Ö –∏ —É —Å—Ç–∞–Ω–∫–∞, –∑–∞—Ç–µ–º –∏–∑—É—á–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏–π –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–∞ –ø—É–∞–Ω—Ç–∞—Ö.'
    };


  // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è populateDirs: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–∫–∞–∑ –æ–ø–∏—Å–∞–Ω–∏—è, –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –æ–ø—Ü–∏–∏ –∏ –∫–Ω–æ–ø–∫–∞ —Å–∫—Ä—ã—Ç—å
function populateDirs(showAll = false) {
  const cont = document.getElementById('options-dir');
  cont.innerHTML = '';
  // –í–∫–ª—é—á–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–∫—Ä–æ–ª–ª–∞
  cont.style.maxHeight = '60vh';
  cont.style.overflowY = 'auto';

  const map = {
  '–£–ª—É—á—à–∏—Ç—å –≥–∏–±–∫–æ—Å—Ç—å': ['–†–∞—Å—Ç—è–∂–∫–∞', '–ü–∏–ª–∞—Ç–µ—Å', '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è (–Ω–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)'],
  '–£–∫—Ä–µ–ø–∏—Ç—å —Ç–µ–ª–æ': ['–ë–æ–¥–∏-–ë–∞–ª–µ—Ç', '–ë–∞—Ä—Ä–µ', '–ë–∞–ª–µ—Ç–Ω–∞—è –ø–æ–¥–∫–∞—á–∫–∞', '–ü–∏–ª–∞—Ç–µ—Å'],
  '–£–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–π –≤–µ—Å': ['–ë–æ–¥–∏-–ë–∞–ª–µ—Ç', '–ë–∞–ª–µ—Ç–Ω–∞—è –ø–æ–¥–∫–∞—á–∫–∞', '–ë–∞—Ä—Ä–µ', '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è (–Ω–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)'],
  '–°–Ω—è—Ç—å —Å—Ç—Ä–µ—Å—Å': ['–ü–∏–ª–∞—Ç–µ—Å', '–†–∞—Å—Ç—è–∂–∫–∞', '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è (–Ω–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)'],
  '–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Å–∞–Ω–∫—É': ['–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è (–Ω–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)', '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è (—Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å)', '–ë–∞—Ä—Ä–µ', '–ü–∏–ª–∞—Ç–µ—Å'],
  '–ü–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å': ['–ë–æ–¥–∏-–ë–∞–ª–µ—Ç', '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è (–Ω–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)', '–¢–∞–Ω—Ü—ã –Ω–∞—Ä–æ–¥–æ–≤ –º–∏—Ä–∞'],
  '–ù–∞—É—á–∏—Ç—å—Å—è —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å': ['–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è (–Ω–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)', '–¢–∞–Ω—Ü—ã –Ω–∞—Ä–æ–¥–æ–≤ –º–∏—Ä–∞', '–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø—É–∞–Ω—Ç—ã'],
  '–ù–∞—á–∞—Ç—å –∑–∞–Ω–∏–º–∞—Ç—å—Å—è': ['–ü–∏–ª–∞—Ç–µ—Å', '–†–∞—Å—Ç—è–∂–∫–∞', '–ë–∞—Ä—Ä–µ'],
  '–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—é': ['–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è (—Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å)', '–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø—É–∞–Ω—Ç—ã', '–¢–∞–Ω—Ü—ã –Ω–∞—Ä–æ–¥–æ–≤ –º–∏—Ä–∞'],
  '–£–ª—É—á—à–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é': ['–ë–æ–¥–∏-–ë–∞–ª–µ—Ç', '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è (–Ω–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)', '–ë–∞—Ä—Ä–µ']
};


  const list = showAll ? Object.keys(directionDescriptions) : (map[data.goal] || []);

  list.forEach(val => {
    const d = document.createElement('div');
    d.className = 'option';
    d.dataset.val = val;
    if (data.direction === val) d.classList.add('selected');

    // –í—Å—Ç–∞–≤–ª—è–µ–º HTML –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ã–π –≤ template –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
    d.innerHTML = `
      <span>${val}</span>
      <button class="info-btn" title="–ü–æ–¥—Ä–æ–±–Ω–µ–µ">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2"/>
          <path d="M12 16V12M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
      <div class="description">${directionDescriptions[val] || ''}</div>
      <button class="collapse-btn" title="–°–∫—Ä—ã—Ç—å">–°–∫—Ä—ã—Ç—å</button>
    `;

    const infoBtn = d.querySelector('.info-btn');
    const desc = d.querySelector('.description');
    const collapseBtn = d.querySelector('.collapse-btn');
    // –°–∫—Ä—ã–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –∫–Ω–æ–ø–∫—É
    desc.classList.remove('active');
    collapseBtn.style.display = 'none';

    // –ö–ª–∏–∫ –ø–æ info-btn ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –∫–Ω–æ–ø–∫—É —Å–∫—Ä—ã—Ç—å
    infoBtn.addEventListener('click', e => {
      e.stopPropagation();
      desc.classList.add('active');
      collapseBtn.style.display = 'inline-block';
      infoBtn.style.display = 'none';
      desc.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    });

    // –ö–Ω–æ–ø–∫–∞ —Å–∫—Ä—ã—Ç—å ‚Äî –ø—Ä—è—á–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Å–µ–±—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç info-btn
    collapseBtn.addEventListener('click', e => {
      e.stopPropagation();
      desc.classList.remove('active');
      collapseBtn.style.display = 'none';
      infoBtn.style.display = 'flex';
    });

    // –ö–ª–∏–∫ –ø–æ –æ–ø—Ü–∏–∏ ‚Äî –≤—ã–¥–µ–ª–µ–Ω–∏–µ
    d.addEventListener('click', e => {
      if (e.target.closest('.info-btn') || e.target.closest('.collapse-btn')) return;
      document.querySelectorAll('#options-dir .option').forEach(o => o.classList.remove('selected'));
      d.classList.add('selected');
      data.direction = val;
    });

    cont.appendChild(d);
  });
}

document.getElementById('weekBtn').addEventListener('click', function() {
  if (!data.direction || !data.address) {
    alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —Å—Ç—É–¥–∏—é');
    return;
  }
  
  fetchAndShowSlots(7);
});


document.getElementById('options-slots').addEventListener('click', function(e) {
  if (e.target && e.target.id === 'weekBtn') {
    fetchAndShowSlots(7);
  }
});

async function fetchAndShowSlots(days = 3) {
  if (!data.direction || !data.address) {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —Å—Ç—É–¥–∏—é');
    return;
  }

  try {
    const response = await fetch('/slots', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        direction: data.direction,
        address: data.address,
        days: days
      })
    });

    if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
    const result = await response.json();
       
    if (!result.ok) {
      throw new Error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–æ—Ç–æ–≤');
    }

    const slots = result.slots || [];
    const cont = document.getElementById('options-slots');
    cont.innerHTML = '';
    cont.style.maxHeight = '300px';
    cont.style.overflowY = 'auto';
    let hasSlots = false;

    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Å–ª–æ—Ç—ã –ø–æ –¥–Ω—è–º
    const slotsByDate = {};
    slots.forEach(slot => {
      if (!slotsByDate[slot.date]) {
        slotsByDate[slot.date] = [];
      }
      slotsByDate[slot.date].push(slot);
    });

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–æ—Ç—ã –ø–æ –¥–Ω—è–º
    Object.keys(slotsByDate).sort().forEach(date => {
      const dateStr = new Date(date).toLocaleDateString('ru-RU', {
        day: 'numeric',
        month: 'long',
        weekday: 'short'
      });
         
      slotsByDate[date].forEach(slot => {
        hasSlots = true;
        const b = document.createElement('div');
        b.className = 'option';
        b.textContent = `${dateStr} ‚Äî ${slot.time}`;
        b.onclick = () => {
          document.querySelectorAll('#options-slots .option').forEach(o =>
            o.classList.remove('selected')
          );
          b.classList.add('selected');
          data.slot = `${date}, ${slot.time}`;
        };
        cont.appendChild(b);
      });
    });

    if (!hasSlots) {
      const noSlots = document.createElement('div');
      noSlots.style.padding = '20px';
      noSlots.style.textAlign = 'center';
      noSlots.style.color = 'var(--text-muted)';
      noSlots.textContent = `–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ ${days} –¥–Ω–µ–π`;
      cont.appendChild(noSlots);
    }

    show('step-5');
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:', error);
    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ');
  }
}

  </script>
</body>
</html>


